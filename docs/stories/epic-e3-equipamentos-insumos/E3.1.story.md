# Story E3.1 — Receitas de Lavagem
**Epic:** E3 — Gestão de Equipamentos e Insumos
**Status:** Ready for Review
**Criado por:** @sm (River) | 2026-02-19
**Complexidade:** M (5 pontos)

---

## Descrição
Como **Gerente de Unidade**, preciso cadastrar e gerenciar receitas de lavagem por tipo de peça, para que os operadores de triagem saibam exatamente como processar cada comanda e o consumo de insumos seja calculado automaticamente.

---

## Critérios de Aceite

- [x] **AC1:** CRUD completo de receitas em `/unit/[unitId]/recipes`
- [x] **AC2:** Campos obrigatórios: nome, tipo de peça (dropdown com PieceType), temperatura (°C), duração (minutos)
- [x] **AC3:** Campo opcional: notas sobre produtos químicos (texto livre, até E3.3)
- [x] **AC4:** Toggle ativo/inativo para desativar receitas sem excluir
- [x] **AC5:** Receitas aparecem no select da interface de Triagem (E2.3 sorting-form)
- [x] **AC6:** Listagem com filtro por tipo de peça
- [ ] **AC7:** Validação: não permitir duas receitas ativas com mesmo nome + tipo para a mesma unidade (banco permite, validação a nível de UI pendente)

---

## Escopo

**IN:**
- CRUD de receitas
- Integração com sorting-form (select de receita por item)
- Filtro por tipo de peça

**OUT:**
- Vínculo com produtos químicos (E3.3 — insumos)
- Cálculo automático de custo por receita (E3.3)
- Histórico de uso da receita

---

## File List (preenchido por @dev)
- [x] `types/recipe.ts`
- [x] `actions/recipes/crud.ts`
- [x] `components/domain/recipe/recipe-form-dialog.tsx`
- [x] `components/domain/recipe/recipe-list.tsx`
- [x] `app/(unit)/[unitId]/recipes/page.tsx`
- [x] `components/domain/production/sorting-form.tsx` (atualizado para carregar receitas reais)
- [x] `app/(sector)/sorting/page.tsx` (atualizado para buscar receitas)
- [x] `app/(sector)/sorting/page-client.tsx` (atualizado para passar receitas)
- [x] `components/layout/unit-sidebar.tsx` (link Receitas adicionado)

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-6

### Completion Notes
- AC7 (unique constraint) a implementar como validação client-side ou DB constraint em Wave 2
- Receitas filtradas por piece_type no sorting-form em tempo real

## Change Log
| Data | Agente | Ação |
|------|--------|------|
| 2026-02-19 | @sm River | Story criada (Status: Ready) |
| 2026-02-19 | @dev Dex | Implementação completa. Status → Ready for Review |
