# Story E7.3 — NPS por Unidade
**Epic:** E7 — Dashboard e KPIs
**Status:** Ready for Review
**Criado por:** @sm (River) | 2026-02-19
**Complexidade:** M (5 pontos)

---

## Critérios de Aceite

- [x] **AC1:** Migration `015_nps.sql`: tabelas `nps_surveys` (id, unit_id, client_id, sent_at) e `nps_responses` (id, survey_id, score 0-10, comment, answered_at)
- [x] **AC2:** Página pública `/nps/[surveyId]` — formulário simples com escala 0-10 + campo de comentário (sem autenticação necessária)
- [x] **AC3:** Ação para registrar resposta NPS (upsert por survey_id)
- [x] **AC4:** Query `getNpsScoreByUnit` calcula NPS = (promotores% - detratores%) onde promotores = score ≥ 9, detratores = score ≤ 6
- [x] **AC5:** Card NPS por unidade no dashboard do Diretor (score + total de respostas)
- [x] **AC6:** Página `/director/nps` lista surveys enviados, score por unidade e comentários recentes

---

## File List (preenchido por @dev)
- [x] `supabase/migrations/015_nps.sql`
- [x] `types/nps.ts`
- [x] `actions/nps/respond.ts`
- [x] `actions/director/nps.ts`
- [x] `app/(public)/nps/[surveyId]/page.tsx`
- [x] `app/(public)/layout.tsx`
- [x] `app/(director)/nps/page.tsx`
- [x] `components/domain/director/nps-summary.tsx`
- [x] `app/(director)/dashboard/page.tsx` (card NPS adicionado)

## Dev Agent Record
### Agent Model Used
claude-sonnet-4-6

## Change Log
| Data | Agente | Ação |
|------|--------|------|
| 2026-02-19 | @sm River | Story criada (Status: Ready) |
| 2026-02-19 | @dev Dex | Implementação completa. Status → Ready for Review |
