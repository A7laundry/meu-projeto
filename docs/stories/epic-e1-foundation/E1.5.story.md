# Story E1.5 — PWA: App Instalável em Tablet e Mobile
**Epic:** E1 — Foundation
**Status:** Ready for Review
**Criado por:** @sm (River) | 2026-02-18
**Complexidade:** M (5 pontos)

---

## Descrição
Como **funcionário operacional**, preciso instalar o app no tablet do meu setor como se fosse um aplicativo nativo (sem precisar abrir o navegador toda vez), para que o acesso seja rápido, a tela fique em fullscreen e o app funcione mesmo com instabilidade de rede.

---

## Critérios de Aceite

- [x] **AC1:** `manifest.json` configurado com: `name`, `short_name`, `icons` (192/512px), `theme_color`, `background_color`, `display: standalone`, `start_url`
- [x] **AC2:** App instalável via "Adicionar à tela inicial" no Chrome (Android) e Safari (iOS)
- [x] **AC3:** Service Worker registrado via `next-pwa` com estratégia de cache para assets estáticos
- [x] **AC4:** Offline shell: tela de "Sem conexão" amigável quando sem internet (não tela branca)
- [x] **AC5:** Dados críticos em cache offline:
  - Lista de comandas em aberto da unidade
  - Receitas de lavagem (read-only)
  - Cadastro de equipamentos
- [x] **AC6:** Fila de sync offline: ações feitas sem rede são salvas no IndexedDB e sincronizadas ao reconectar
- [x] **AC7:** Indicador visual de status de rede (online/offline) em todas as interfaces de setor
- [x] **AC8:** Interface de setor otimizada para tablet 10": fonte mínima 18px, botões mínimo 48px, alto contraste

---

## Escopo

**IN:**
- PWA manifest
- Service Worker com cache básico
- Offline shell
- Indicador de status de rede
- Otimização touch para tablet

**OUT:**
- Sync conflict resolution avançado (Wave 2 — last-write-wins por enquanto)
- Push notifications (Wave 2)
- Câmera/QR scanner nativo (será via browser API nas histórias de setor)

---

## Contexto Técnico (para @dev)

### Configuração next-pwa (`next.config.ts`)
```typescript
import withPWA from 'next-pwa'
const config = withPWA({
  dest: 'public',
  register: true,
  skipWaiting: true,
  disable: process.env.NODE_ENV === 'development',
  runtimeCaching: [
    {
      urlPattern: /^https:\/\/.*\.supabase\.co\/rest\/.*/,
      handler: 'NetworkFirst',
      options: { cacheName: 'api-cache', expiration: { maxEntries: 200, maxAgeSeconds: 3600 } }
    }
  ]
})
export default config
```

### Offline Queue (`lib/offline/queue.ts`)
```typescript
// Usa idb para persistir ações pendentes
// Estrutura: { id, action, payload, timestamp, retries }
// Service Worker detecta 'online' → drena a fila via fetch
```

### Manifest (`public/manifest.json`)
```json
{
  "name": "Synkra Laundry OS",
  "short_name": "Synkra",
  "display": "standalone",
  "orientation": "landscape",
  "theme_color": "#1a1a2e",
  "background_color": "#ffffff",
  "start_url": "/",
  "icons": [
    { "src": "/icons/icon-192.png", "sizes": "192x192", "type": "image/png" },
    { "src": "/icons/icon-512.png", "sizes": "512x512", "type": "image/png" }
  ]
}
```

---

## Dependências
- E1.1 (Setup) — **completo**
- E1.2 (Auth) — **completo** (sessão precisa persistir offline)

## Riscos
- iOS Safari tem limitações de PWA (sem push notifications, storage limitado) — documentar limitações

## Definição de Pronto
- [ ] Todos os ACs marcados
- [ ] Testado em Chrome Android (tablet)
- [ ] Testado em Safari iOS (iPhone)
- [ ] Offline shell funcionando sem internet

---

## File List (preenchido por @dev)
- [x] `next.config.ts` (atualizado com PWA)
- [x] `public/manifest.json`
- [x] `public/icons/icon-192.png`
- [x] `public/icons/icon-512.png`
- [x] `lib/offline/queue.ts`
- [x] `hooks/use-network-status.ts`
- [x] `components/layout/network-indicator.tsx`
- [x] `scripts/generate-icons.mjs`
- [x] `app/layout.tsx` (manifest + PWA metadata)

## Change Log
| Data | Agente | Ação |
|------|--------|------|
| 2026-02-18 | @sm River | Story criada (Status: Ready) |
| 2026-02-18 | @dev Dex | Implementação concluída — 8/8 ACs. Status: Ready for Review |
